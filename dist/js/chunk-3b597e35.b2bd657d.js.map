{"version":3,"sources":["webpack:///./src/views/auth/Github.vue?1543","webpack:///./src/api/auth.ts","webpack:///./src/module/auth.ts","webpack:///./src/views/auth/Github.vue?562b","webpack:///./src/views/auth/Github.vue","webpack:///./src/views/auth/Github.vue?f79e","webpack:///./src/views/auth/Github.vue?0e8f"],"names":["LOGIN_API","data","ajax","post","get","login","res","msg","code","success","updateToken","Promise","resolve","console","log","store","dispatch","updateUser","localStorage","setItem","tokenName","token","type","logout","removeItem","User","updateTasks","updateMessages","register","loginByGithub","render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","_v","staticRenderFns","extend","name","created","$route","query","$router","replace","components","component"],"mappings":"yIAAA,yBAA4jB,EAAG,G,4GCKzjBA,EAAY,GAAH,OAAM,OAAN,SAEF,EAAQ,SAACC,GAAD,OAAoDC,EAAA,KAAKC,KAAL,UAAaH,EAAb,UAAgCC,IAC5F,EAAW,SAACA,GAAD,OAAoDC,EAAA,KAAKC,KAAL,UAAaH,EAAb,aAAmCC,IAClG,EAAkB,SAACA,GAAD,OAA+CC,EAAA,KAAKE,IAAL,UAAYJ,EAAZ,mBAAgCC,K,gGCE/F,QACPI,MADO,SACAJ,GAAe,uLAEN,EAAMA,GAFA,cAElBK,EAFkB,OAGxB,eAAMA,EAAIC,KACND,EAAIE,OAAS,OAASC,SACxB,EAAKC,YAAYJ,EAAIL,MALC,kBAOjBU,QAAQC,QAAQN,EAAIE,OAAS,OAASC,UAPrB,0CASxBI,QAAQC,IAAR,MATwB,kBAUjBH,QAAQC,SAAQ,IAVC,4DAatBF,YAdO,SAcMT,GAAW,6JACtBc,EAAA,KAAMC,SAAS,OAAUC,WAAYhB,GADf,OAE5BiB,aAAaC,QAAQ,OAAOC,UAAWnB,EAAKoB,OAC5C,eAAoB,CAAEC,KAAM,OAASD,MAAOd,IAAKN,EAAKoB,QAH1B,8CAKxBE,OAnBO,WAmBD,oJACVL,aAAaM,WAAW,OAAOJ,WADrB,SAEJL,EAAA,KAAMC,SAAS,OAAUC,WAAY,IAAIQ,EAAA,MAFrC,uBAGJV,EAAA,KAAMC,SAAS,OAAUU,YAAa,IAHlC,uBAIJX,EAAA,KAAMC,SAAS,OAAUW,eAAgB,IAJrC,gCAKHhB,QAAQC,SAAQ,IALb,8CAONgB,SA1BO,SA0BG3B,GAAe,4KAET,EAASA,GAFA,cAErBK,EAFqB,OAG3B,eAAMA,EAAIC,KAHiB,kBAIpBI,QAAQC,QAAQN,EAAIE,OAAS,OAASC,UAJlB,0CAM3BI,QAAQC,IAAR,MAN2B,kBAOpBH,QAAQC,SAAQ,IAPI,4DAUzBiB,cApCO,SAoCQrB,GAAY,4KAEX,EAAgBA,GAFL,cAEvBF,EAFuB,yBAGtBK,QAAQC,QAAQN,EAAIL,OAHE,0CAK7BY,QAAQC,IAAR,MAL6B,kBAMtBH,QAAQC,QAAQ,OANM,8D,yCC/CnC,IAAIkB,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,aAAa,CAACF,EAAG,cAAc,CAACG,MAAM,CAAC,KAAO,OAAO,SAAW,KAAK,CAACP,EAAIQ,GAAG,aAAa,IAC5MC,EAAkB,G,wGCUP,G,oBAAA,OAAIC,OAAO,CACxBC,KAAM,cACAC,QAFkB,WAEX,mKACHnC,EAAS,EAAKoC,OAAOC,MAArBrC,KACY,kBAATA,EAFA,iEAGO,OAAWqB,cAAcrB,GAHhC,UAGLF,EAHK,QAIPA,EAJO,iCAKH,OAAWI,YAAYJ,GALpB,OAMT,EAAKwC,QAAQC,QAAQ,SANZ,+CASbC,WAAY,kBACT,OAAQN,KAAO,WCvB+U,I,wBCQ/VO,EAAY,eACd,EACAnB,EACAU,GACA,EACA,KACA,WACA,MAIa,aAAAS,E","file":"js/chunk-3b597e35.b2bd657d.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Github.vue?vue&type=style&index=0&id=65b8ee42&scoped=true&lang=less&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Github.vue?vue&type=style&index=0&id=65b8ee42&scoped=true&lang=less&\"","import { BASE_API } from './index'\r\nimport { AjaxResponseI, LoginReqI } from '@/interface/ajax'\r\nimport ajax from '@/util/ajax'\r\nimport { UserI } from '@/interface/model'\r\n\r\nconst LOGIN_API = `${BASE_API}/auth`\r\n\r\nexport const LOGIN = (data: LoginReqI): Promise<AjaxResponseI<UserI>> => ajax.post(`${LOGIN_API}/login`, data)\r\nexport const REGISTER = (data: LoginReqI): Promise<AjaxResponseI<UserI>> => ajax.post(`${LOGIN_API}/register`, data)\r\nexport const LOGIN_BY_GITHUB = (data: string): Promise<AjaxResponseI<any>> => ajax.get(`${LOGIN_API}/github/${data}`)\r\n","import { LoginReqI } from '@/interface/ajax'\r\nimport { LOGIN, LOGIN_BY_GITHUB, REGISTER } from '@/api/auth'\r\nimport { Toast } from 'vant'\r\nimport { MSG_TYPE, RES_CODE } from '@/constant'\r\nimport store from '@/store'\r\nimport { ACTIONS_E } from '@/store/actions'\r\nimport CONFIG from '@/config'\r\nimport User from '@/models/User'\r\nimport { postMessage } from '@/worker/alarm'\r\nimport { UserI } from '@/interface/model'\r\n\r\nexport default {\r\n  async login (data: LoginReqI) {\r\n    try {\r\n      const res = await LOGIN(data)\r\n      Toast(res.msg)\r\n      if (res.code === RES_CODE.success) {\r\n        this.updateToken(res.data)\r\n      }\r\n      return Promise.resolve(res.code === RES_CODE.success)\r\n    } catch (e) {\r\n      console.log(e)\r\n      return Promise.resolve(false)\r\n    }\r\n  },\r\n  async updateToken (data: UserI) {\r\n    await store.dispatch(ACTIONS_E.updateUser, data)\r\n    localStorage.setItem(CONFIG.tokenName, data.token)\r\n    postMessage<string>({ type: MSG_TYPE.token, msg: data.token })\r\n  },\r\n  async logout () {\r\n    localStorage.removeItem(CONFIG.tokenName)\r\n    await store.dispatch(ACTIONS_E.updateUser, new User())\r\n    await store.dispatch(ACTIONS_E.updateTasks, [])\r\n    await store.dispatch(ACTIONS_E.updateMessages, [])\r\n    return Promise.resolve(true)\r\n  },\r\n  async register (data: LoginReqI) {\r\n    try {\r\n      const res = await REGISTER(data)\r\n      Toast(res.msg)\r\n      return Promise.resolve(res.code === RES_CODE.success)\r\n    } catch (e) {\r\n      console.log(e)\r\n      return Promise.resolve(false)\r\n    }\r\n  },\r\n  async loginByGithub (code: string): Promise<UserI | null> {\r\n    try {\r\n      const res = await LOGIN_BY_GITHUB(code)\r\n      return Promise.resolve(res.data)\r\n    } catch (e) {\r\n      console.log(e)\r\n      return Promise.resolve(null)\r\n    }\r\n  }\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container\"},[_c('van-loading',{attrs:{\"size\":\"24px\",\"vertical\":\"\"}},[_vm._v(\"登录中...\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\r\nimport Vue from 'vue'\r\nimport AuthModule from '@/module/auth'\r\nimport { Loading } from 'vant'\r\n\r\nexport default Vue.extend({\r\n  name: 'githubLogin',\r\n  async created () {\r\n    const { code } = this.$route.query\r\n    if (typeof code !== 'string') return\r\n    const res = await AuthModule.loginByGithub(code)\r\n    if (res) {\r\n      await AuthModule.updateToken(res)\r\n      this.$router.replace('/task')\r\n    }\r\n  },\r\n  components: {\r\n    [Loading.name]: Loading\r\n  }\r\n})\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Github.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Github.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Github.vue?vue&type=template&id=65b8ee42&scoped=true&\"\nimport script from \"./Github.vue?vue&type=script&lang=ts&\"\nexport * from \"./Github.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Github.vue?vue&type=style&index=0&id=65b8ee42&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"65b8ee42\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}