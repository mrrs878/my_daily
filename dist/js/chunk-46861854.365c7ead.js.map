{"version":3,"sources":["webpack:///./src/api/auth.ts","webpack:///./src/module/auth.ts","webpack:///./src/views/profile/Setting.vue?9476","webpack:///./src/views/profile/Setting.vue","webpack:///./src/views/profile/Setting.vue?9f9b","webpack:///./src/views/profile/Setting.vue?d64a"],"names":["LOGIN_API","data","ajax","post","get","login","res","msg","code","success","updateToken","Promise","resolve","console","log","store","dispatch","updateUser","localStorage","setItem","tokenName","token","type","logout","removeItem","User","updateTasks","register","loginByGithub","render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","onNavBarClickLeft","onCleanCacheClick","onSetRefreshRateCellClick","onLogoutClick","_v","model","value","callback","$$v","isSetRatePopup","expression","refreshRates","onSetRefreshCfmClick","staticRenderFns","extend","name","methods","cleanCache","update","then","catch","e","confirm","title","message","setRefreshRate","$router","replace","task","component"],"mappings":"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","file":"js/chunk-46861854.365c7ead.js","sourcesContent":["import { BASE_API } from './index'\r\nimport { AjaxResponseI, LoginReqI } from '@/interface/ajax'\r\nimport ajax from '@/util/ajax'\r\nimport { UserI } from '@/interface/model'\r\n\r\nconst LOGIN_API = `${ BASE_API }/auth`\r\n\r\nexport const LOGIN = (data: LoginReqI): Promise<AjaxResponseI<UserI>> => ajax.post(`${LOGIN_API}/login`, data)\r\nexport const REGISTER = (data: LoginReqI): Promise<AjaxResponseI<UserI>> => ajax.post(`${LOGIN_API}/register`, data)\r\nexport const LOGIN_BY_GITHUB = (data: string): Promise<AjaxResponseI<any>> => ajax.get(`${LOGIN_API}/github/${data}`)\r\n","import { LoginReqI } from '@/interface/ajax'\r\nimport {LOGIN, LOGIN_BY_GITHUB, REGISTER} from '@/api/auth'\r\nimport { Toast } from 'vant'\r\nimport {MSG_TYPE, RES_CODE} from '@/constant'\r\nimport store from '@/store'\r\nimport { ACTIONS_E } from '@/store/actions'\r\nimport CONFIG from '@/config'\r\nimport User from '@/models/User'\r\nimport { postMessage } from '@/worker/alarm'\r\nimport {UserI} from \"@/interface/model\";\r\n\r\nexport default {\r\n  async login (data: LoginReqI) {\r\n    try {\r\n      const res = await LOGIN(data)\r\n      Toast(res.msg)\r\n      if (res.code === RES_CODE.success) {\r\n        this.updateToken(res.data)\r\n      }\r\n      return Promise.resolve(res.code === RES_CODE.success)\r\n    } catch (e) {\r\n      console.log(e)\r\n      return Promise.resolve(false)\r\n    }\r\n  },\r\n  async updateToken (data: UserI) {\r\n    await store.dispatch(ACTIONS_E.updateUser, data)\r\n    localStorage.setItem(CONFIG.tokenName, data.token)\r\n    postMessage<string>({ type: MSG_TYPE.token, msg: data.token })\r\n  },\r\n  async logout () {\r\n    localStorage.removeItem(CONFIG.tokenName)\r\n    await store.dispatch(ACTIONS_E.updateUser, new User())\r\n    await store.dispatch(ACTIONS_E.updateTasks, [])\r\n    return Promise.resolve(true)\r\n  },\r\n  async register (data: LoginReqI) {\r\n    try {\r\n      const res = await REGISTER(data)\r\n      Toast(res.msg)\r\n      return Promise.resolve(res.code === RES_CODE.success)\r\n    } catch (e) {\r\n      console.log(e)\r\n      return Promise.resolve(false)\r\n    }\r\n  },\r\n  async loginByGithub (code: string): Promise<UserI | null> {\r\n    try {\r\n      const res = await LOGIN_BY_GITHUB(code)\r\n      return Promise.resolve(res.data)\r\n    } catch (e) {\r\n      console.log(e)\r\n      return Promise.resolve(null)\r\n    }\r\n  }\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container\"},[_c('van-nav-bar',{attrs:{\"left-text\":\"设置\",\"left-arrow\":\"\"},on:{\"click-left\":_vm.onNavBarClickLeft}}),_c('van-cell',{attrs:{\"title\":\"更新缓存\",\"is-link\":\"\"},on:{\"click\":_vm.onCleanCacheClick}}),_c('van-cell',{attrs:{\"title\":\"任务提醒灵敏度\",\"value\":\"1min\",\"is-link\":\"\"},on:{\"click\":_vm.onSetRefreshRateCellClick}}),_c('br'),_c('br'),_c('van-button',{attrs:{\"type\":\"primary\",\"size\":\"large\"},on:{\"click\":_vm.onLogoutClick}},[_vm._v(\"退出登录\")]),_c('van-popup',{attrs:{\"closeable\":\"\",\"close-icon-position\":\"top-left\",\"round\":\"\",\"position\":\"bottom\"},model:{value:(_vm.isSetRatePopup),callback:function ($$v) {_vm.isSetRatePopup=$$v},expression:\"isSetRatePopup\"}},[_c('van-picker',{attrs:{\"show-toolbar\":\"\",\"title\":\"选择刷新间隔(min)\",\"columns\":_vm.refreshRates},on:{\"confirm\":_vm.onSetRefreshCfmClick}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from 'vue'\r\nimport { Dialog, Toast } from 'vant'\r\nimport AuthModule from '@/module/auth'\r\nimport { ROUTES_MAP } from '@/router'\r\nimport { postMessage } from '@/worker/alarm'\r\nimport { MSG_TYPE } from '@/constant'\r\nimport { swReg } from '@/registerServiceWorker'\r\n\r\nexport default Vue.extend({\r\n  name: 'setting',\r\n  data () {\r\n    return {\r\n      isSetRatePopup: false,\r\n      refreshRates: [1, 5, 10]\r\n    }\r\n  },\r\n  methods: {\r\n    cleanCache () {\r\n      swReg.update().then(() => {\r\n        Toast('更新成功')\r\n      }).catch(e => {\r\n        console.log(e)\r\n      })\r\n    },\r\n    onCleanCacheClick () {\r\n      Dialog.confirm({\r\n        title: '提示',\r\n        message: '确定更新缓存吗?'\r\n      }).then(this.cleanCache).catch(() => {})\r\n    },\r\n    onSetRefreshRateCellClick () {\r\n      this.isSetRatePopup = true\r\n    },\r\n    onSetRefreshCfmClick (e: number) {\r\n      this.isSetRatePopup = false\r\n      postMessage<number>({ type: MSG_TYPE.setRefreshRate, msg: e })\r\n    },\r\n    async onLogoutClick () {\r\n      try {\r\n        Dialog.confirm({\r\n          title: '提示',\r\n          message: '确定退出登录吗?'\r\n        }).then(async () => {\r\n          const res = await AuthModule.logout()\r\n          if (res) await this.$router.replace(ROUTES_MAP.task)\r\n        }).catch(() => {})\r\n      } catch (e) {\r\n        console.log(e)\r\n      }\r\n    }\r\n  }\r\n})\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Setting.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Setting.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Setting.vue?vue&type=template&id=64edd27b&\"\nimport script from \"./Setting.vue?vue&type=script&lang=ts&\"\nexport * from \"./Setting.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}